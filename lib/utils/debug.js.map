{"version":3,"sources":["../../src/utils/debug.js"],"names":["buildKey","key","value","waiting","full","expire","created","TTL","expireKey","Date","now","Object","assign","started","wait","waitUntil","extractProps","obj","ret","keys","filter","test","forEach","getCacheInfo","info","search","cache","maxAge","stale","hot","matcher","keyInfo","get","push","itemCount"],"mappings":";;;;;;;kQAAA;;;;;AAGA;;AAKO,MAAMA,8BAAW,CAAC,EAACC,GAAD,EAAMC,KAAN,EAAaC,OAAb,EAAsBC,IAAtB,EAAD,KAAiC;AACvD,QAAMC,SAASH,MAAMI,OAAN,GAAgBJ,MAAMK,GAArC;AACA,QAAMC,YAAYH,SAASI,KAAKC,GAAL,EAAT,GAAsB,SAAtB,GAAkC,SAApD;AACA,SAAOC,OAAOC,MAAP,CAAc;AACnBX,OADmB;AAEnBK,aAAS,IAAIG,IAAJ,CAASP,MAAMI,OAAf,CAFU;AAGnB,KAACE,SAAD,GAAa,IAAIC,IAAJ,CAASJ,MAAT;AAHM,GAAd,EAKPF,UAAU;AACRA,aAAS;AACPU,eAAS,IAAIJ,IAAJ,CAASN,QAAQU,OAAjB,CADF;AAEPC,YAAMX,QAAQW,IAFP;AAGPC,iBAAW,IAAIN,IAAJ,CAASN,QAAQY,SAAjB;AAHJ;AADD,GAAV,GAMI,EAXG,EAYPX,OAAO,EAACF,OAAOA,MAAMA,KAAd,EAAP,GAA8B,EAZvB,CAAP;AAaD,CAhBM;;AAkBP,MAAMc,eAAgBC,GAAD,IAAS;AAC5B,QAAMC,MAAM,EAAZ;AACAP,SAAOQ,IAAP,CAAYF,GAAZ,EACGG,MADH,CACWnB,GAAD,IAAS,CAAC,gBAAgBoB,IAAhB,CAAqBpB,GAArB,CADpB,EAEGqB,OAFH,CAEYrB,GAAD,IAAS;AAChBiB,QAAIjB,GAAJ,IAAWgB,IAAIhB,GAAJ,CAAX;AACD,GAJH;AAKA,SAAOiB,GAAP;AACD,CARD;;AAUO,MAAMK,sCAAgBC,IAAD,IAAU;AACpC,QAAM;AACJpB,QADI;AAEJqB,aAAS,GAFL;AAGJC,SAHI;AAIJC,UAJI;AAKJxB;AALI,MAMFqB,IANJ;AAOA,QAAML,OAAO;AACXS,WAAO,EADI;AAEXC,SAAK;AAFM,GAAb;AAIA,QAAMC,UAAU,gCAAaL,MAAb,CAAhB;AACAC,QAAMJ,OAAN,CAAc,CAACpB,KAAD,EAAQD,GAAR,KAAgB;AAC5B,QAAI,CAAC6B,QAAQT,IAAR,CAAapB,GAAb,CAAL,EAAwB;AACtB;AACD;AACD,UAAM8B,UAAU/B,SAAS,EAACC,GAAD,EAAMC,KAAN,EAAaC,SAASA,QAAQ6B,GAAR,CAAY/B,GAAZ,CAAtB,EAAwCG,IAAxC,EAAT,CAAhB;AACA,QAAI,2BAAQF,KAAR,CAAJ,EAAoB;AAClBiB,WAAKU,GAAL,CAASI,IAAT,CAAcF,OAAd;AACD,KAFD,MAEO;AACLZ,WAAKS,KAAL,CAAWK,IAAX,CAAgBF,OAAhB;AACD;AACF,GAVD;AAWA;AACErB,SAAK,IAAID,IAAJ;AADP,KAEKO,aAAaQ,IAAb,CAFL;AAGEG,YAAS,GAAEA,UAAU,OAAO,EAAP,GAAY,EAAtB,CAA0B,GAHvC;AAIEO,eAAWR,MAAMQ,SAJnB;AAKEf;AALF;AAOD,CA/BM","file":"debug.js","sourcesContent":["/**\n * @module\n **/\nimport {\n  isFresh,\n  createRegExp\n} from './cache-helpers'\n\nexport const buildKey = ({key, value, waiting, full}) => {\n  const expire = value.created + value.TTL\n  const expireKey = expire < Date.now() ? 'expired' : 'expires'\n  return Object.assign({\n    key,\n    created: new Date(value.created),\n    [expireKey]: new Date(expire)\n  },\n  waiting ? {\n    waiting: {\n      started: new Date(waiting.started),\n      wait: waiting.wait,\n      waitUntil: new Date(waiting.waitUntil)\n    }\n  } : {},\n  full ? {value: value.value} : {})\n}\n\nconst extractProps = (obj) => {\n  const ret = {}\n  Object.keys(obj)\n    .filter((key) => !/^log$|^cache$/.test(key))\n    .forEach((key) => {\n      ret[key] = obj[key]\n    })\n  return ret\n}\n\nexport const getCacheInfo = (info) => {\n  const {\n    full,\n    search = '*',\n    cache,\n    maxAge,\n    waiting\n  } = info\n  const keys = {\n    stale: [],\n    hot: []\n  }\n  const matcher = createRegExp(search)\n  cache.forEach((value, key) => {\n    if (!matcher.test(key)) {\n      return\n    }\n    const keyInfo = buildKey({key, value, waiting: waiting.get(key), full})\n    if (isFresh(value)) {\n      keys.hot.push(keyInfo)\n    } else {\n      keys.stale.push(keyInfo)\n    }\n  })\n  return {\n    now: new Date(),\n    ...extractProps(info),\n    maxAge: `${maxAge / (1000 * 60 * 60)}h`,\n    itemCount: cache.itemCount,\n    keys\n  }\n}\n"]}